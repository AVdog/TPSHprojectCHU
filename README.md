# Telegram-–±–æ—Ç –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–µ–æ (TPSH)

–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –≤–∏–¥–µ–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

---

## üöÄ –ó–∞–ø—É—Å–∫ (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)

```bash
docker-compose up --build
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞—Ç—å `.env`

```bash
cp .env.example .env
```

### 2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

–ü–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather):

```env
TELEGRAM_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
DB_HOST=db
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=tpsh_db
```

### 3. –ü–æ–ª–æ–∂–∏—Ç—å `videos.json` –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å

```bash
docker-compose up --build
```

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram ‚Üí –ë–æ—Ç (async) ‚Üí PostgreSQL (asyncpg)
              ‚Üì
         Pattern Matching
```

### –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `bot.py` | Telegram-–±–æ—Ç |
| `database.py` | –ë–î + –ø–∞—Ä—Å–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `load_data.py` | –ó–∞–≥—Ä—É–∑–∫–∞ JSON |
| `migrations/001_create_tables.sql` | –°—Ö–µ–º–∞ –ë–î |

### –°—Ö–µ–º–∞ –ë–î

**videos** - –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- `id` (UUID) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ
- `creator_id` (UUID) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫—Ä–µ–∞—Ç–æ—Ä–∞
- `video_created_at` (TIMESTAMP) - –¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `views_count`, `likes_count`, `comments_count`, `reports_count` (INT)
- `created_at`, `updated_at` (TIMESTAMP)

**video_snapshots** - –ø–æ—á–∞—Å–æ–≤—ã–µ —Å–Ω–∏–º–∫–∏:
- `id` (UUID) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–Ω–∏–º–∫–∞
- `video_id` (UUID) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ
- `views_count`, `likes_count`, `comments_count`, `reports_count` (INT) - —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
- `delta_views_count`, `delta_likes_count`, `delta_comments_count`, `delta_reports_count` (INT) - –ø—Ä–∏—Ä–æ—Å—Ç
- `created_at`, `updated_at` (TIMESTAMP)

---

## üîÑ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ SQL

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–í—Ö–æ–¥**: —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
2. **–ü–∞—Ä—Å–∏–Ω–≥**: regex patterns –∏–∑–≤–ª–µ–∫–∞—é—Ç —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
3. **SQL**: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î
4. **–í—ã—Ö–æ–¥**: –æ–¥–Ω–æ —á–∏—Å–ª–æ (COUNT, SUM, etc.)

### –¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤

| –ó–∞–ø—Ä–æ—Å | SQL | –ü—Ä–∏–º–µ—Ä |
|--------|-----|--------|
| **total_videos** | `SELECT COUNT(*) FROM videos` | "–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ?" |
| **videos_by_creator_date** | `SELECT COUNT(*) FROM videos WHERE creator_id = ? AND video_created_at BETWEEN ? AND ?` | "–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ —É –∫—Ä–µ–∞—Ç–æ—Ä–∞ —Å id ... —Å 1 –ø–æ 5 –Ω–æ—è–±—Ä—è?" |
| **videos_with_views_threshold** | `SELECT COUNT(*) FROM videos WHERE views_count > ?` | "–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –Ω–∞–±—Ä–∞–ª–æ –±–æ–ª—å—à–µ 100000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤?" |
| **total_views_on_date** | `SELECT SUM(delta_views_count) FROM video_snapshots WHERE DATE(created_at) = ?` | "–ù–∞ —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤—ã—Ä–æ—Å–ª–∏ –≤—Å–µ –≤–∏–¥–µ–æ 28 –Ω–æ—è–±—Ä—è?" |
| **videos_with_new_views_on_date** | `SELECT COUNT(DISTINCT video_id) FROM video_snapshots WHERE DATE(created_at) = ? AND delta_views_count > 0` | "–°–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–µ–æ –ø–æ–ª—É—á–∞–ª–∏ –Ω–æ–≤—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã 27 –Ω–æ—è–±—Ä—è?" |

### –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∞—Ç

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- "28 –Ω–æ—è–±—Ä—è 2025" ‚Üí `2025-11-28`
- "28 –Ω–æ—è–±—Ä—è" ‚Üí `2025-11-28` (–≥–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- "—Å 1 –ø–æ 5 –Ω–æ—è–±—Ä—è 2025" ‚Üí –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

| –ó–∞–ø—Ä–æ—Å | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|--------|------------|
| –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ –µ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ? | COUNT |
| –°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ —É –∫—Ä–µ–∞—Ç–æ—Ä–∞ —Å id ... —Å 1 –ø–æ 5 –Ω–æ—è–±—Ä—è? | COUNT |
| –°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –Ω–∞–±—Ä–∞–ª–æ –±–æ–ª—å—à–µ 100000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤? | COUNT |
| –ù–∞ —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤—ã—Ä–æ—Å–ª–∏ –≤—Å–µ –≤–∏–¥–µ–æ 28 –Ω–æ—è–±—Ä—è? | SUM |
| –°–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–µ–æ –ø–æ–ª—É—á–∏–ª–∏ –Ω–æ–≤—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã 27 –Ω–æ—è–±—Ä—è? | COUNT DISTINCT |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í—Ä—É—á–Ω—É—é

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å: `docker-compose up --build`
2. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –ß–µ—Ä–µ–∑ @PPS_Check_bot

```
/check @yourbot https://github.com/your/repo YourName
```

---

## üõ† –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –ë–î
docker run -d --name tpsh_db -e POSTGRES_PASSWORD=postgres -p 5432:5432 postgres:15

# –ú–∏–≥—Ä–∞—Ü–∏–∏
psql -h localhost -U postgres -d tpsh_db -f migrations/001_create_tables.sql

# –î–∞–Ω–Ω—ã–µ
python load_data.py

# –ë–æ—Ç
python bot.py
```

---

## üìä –ë–∞–ª–ª—ã (–º–∞–∫—Å. 30)

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–ª–ª—ã |
|----------|-------|
| –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞ | 0-2 |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | 0-2 |
| README | 0-2 |
| –¢–µ—Å—Ç—ã (8 √ó 1.5) | 0-12 |
| PostgreSQL | 4 |
| Async stack | 3 |
| Docker compose | 5 |

---

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **PostgreSQL** - —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **asyncpg** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- **python-telegram-bot v21** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –±–æ—Ç
- **Docker Compose** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
docker-compose logs -f app
```

### –û—à–∏–±–∫–∞ –ë–î
```bash
docker-compose logs db
```

### –°–±—Ä–æ—Å
```bash
docker-compose down -v
docker-compose up --build
```
